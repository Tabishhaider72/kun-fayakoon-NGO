# Firebase Storage CORS Configuration Guide

## Issue: CORS Error on Image Upload

If you're experiencing CORS errors when uploading to Firebase Storage:
```
Access to XMLHttpRequest has been blocked by CORS policy
Response to preflight request doesn't pass access control check
```

## Solution Implemented

We've implemented a **server-side upload approach** that completely bypasses CORS issues by:
1. Accepting file uploads on the client component
2. Sending to a Next.js API route (`/api/upload-gallery`)
3. Processing upload on the server (no CORS issues)
4. Storing to Firebase Storage from server context

This is more secure and reliable than client-side uploads.

## How It Works

```
Client Component
    ↓ (FormData)
Next.js API Route (/api/upload-gallery)
    ↓ (No CORS)
Firebase Storage
    ↓ (Server context)
Firestore Metadata
```

## For Development

If you need client-side uploads without this API route, configure Firebase Storage CORS:

### Using gsutil (Google Cloud SDK)

1. Install Google Cloud SDK
2. Authenticate: `gcloud auth login`
3. Create a `cors.json` file:

```json
[
  {
    "origin": ["http://localhost:3000", "https://yourdomain.com"],
    "method": ["GET", "HEAD", "DELETE", "PUT", "POST", "OPTIONS"],
    "responseHeader": ["Content-Type", "x-goog-meta-*"],
    "maxAgeSeconds": 3600
  }
]
```

4. Apply CORS:
```bash
gsutil cors set cors.json gs://kun-fayakoon.appspot.com
```

### Current Solution (Recommended)

We're using the server-side API route which:
- ✅ No CORS issues
- ✅ More secure (auth on server)
- ✅ Better error handling
- ✅ Server-side validation

## Testing

1. Navigate to `http://localhost:3000/admin/gallery`
2. Login with admin password (default: `admin123`)
3. Upload an image - it should work without CORS errors

## If You Still Get CORS Errors

1. Check browser console for exact error
2. Verify `.env.local` has correct Firebase credentials
3. Ensure API route is accessible: `http://localhost:3000/api/upload-gallery`
4. Check network tab for failed requests

## Production Deployment

When deploying to production:
1. Update admin password in `.env.local`
2. Firebase Storage will work automatically (same domain)
3. No additional CORS configuration needed for server-side uploads
