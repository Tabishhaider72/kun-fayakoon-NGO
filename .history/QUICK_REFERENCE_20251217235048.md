# Firebase Gallery - Quick Reference

## URLs

| Page | URL | Purpose |
|------|-----|---------|
| Admin Login | `http://localhost:3000/admin/gallery` | Upload images |
| Public Gallery | `http://localhost:3000/gallery` | View all images |
| API Upload | `POST /api/upload-gallery` | Server-side upload |

## Credentials

| Item | Default | Location |
|------|---------|----------|
| Admin Password | `admin123` | `.env.local` |
| Admin Secret | `(optional)` | `.env.local` |

## File Validation

| Constraint | Value | Error Message |
|-----------|-------|---------------|
| File Types | JPEG, PNG, WebP, GIF | "Invalid file type" |
| Max Size | 500 KB | "File size exceeds 500 KB" |
| Min Width | 400 px | "Image width too small" |
| Max Width | 4000 px | "Image width too large" |
| Min Height | 300 px | "Image height too small" |
| Max Height | 4000 px | "Image height too large" |

## Environment Variables Required

```env
NEXT_PUBLIC_FIREBASE_API_KEY=
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=
NEXT_PUBLIC_FIREBASE_PROJECT_ID=
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=
NEXT_PUBLIC_FIREBASE_APP_ID=
NEXT_PUBLIC_ADMIN_PASSWORD=
ADMIN_SECRET_KEY=
```

## Firebase Collections

### Firestore: `gallery`

```javascript
{
  title: string,           // "Winter Relief Drive"
  subtitle: string,        // "Blankets for families"
  imageUrl: string,        // "https://firebasestorage..."
  storagePath: string,     // "gallery/1702874741000_image.jpg"
  createdAt: timestamp     // Firestore server timestamp
}
```

### Storage: `/gallery/{timestamp}_{filename}`

```
gs://kun-fayakoon.appspot.com/gallery/1702874741000_image.jpg
```

## API Endpoints

### POST `/api/upload-gallery`

**Request:**
```
Content-Type: multipart/form-data

- file: File
- title: string
- subtitle: string
```

**Response (Success):**
```json
{
  "success": true,
  "id": "documentId",
  "imageUrl": "https://firebasestorage..."
}
```

**Response (Error):**
```json
{
  "error": "Error message"
}
```

## Troubleshooting

| Error | Solution |
|-------|----------|
| CORS error | Already fixed with API route! Just update `.env.local` |
| Upload fails | Check file size < 500 KB, refresh browser |
| Image not in gallery | Check Firestore for document, verify API response |
| Admin won't login | Verify password in `.env.local` |
| No Firebase connection | Check internet, verify credentials |

## Key Files

| File | Purpose |
|------|---------|
| `lib/firebase.ts` | Firebase initialization |
| `lib/gallery.ts` | Client-side gallery functions |
| `lib/gallery-actions.ts` | Server-side auth & metadata |
| `app/api/upload-gallery/route.ts` | **Upload API (fixes CORS)** |
| `app/admin/gallery/page.tsx` | Admin upload interface |
| `app/gallery/page.tsx` | Public gallery view |
| `components/GalleryDynamic.tsx` | Gallery display component |

## Common Commands

```powershell
# Start dev server
pnpm dev

# Open admin panel
# Then navigate to http://localhost:3000/admin/gallery

# View gallery
# Navigate to http://localhost:3000/gallery
```

## CORS Solution Summary

✅ **No CORS issues anymore!**

All uploads go through `/api/upload-gallery` which:
- Runs on your server (same origin)
- No browser CORS restrictions
- More secure & reliable
- Works everywhere (localhost, production)

**Old way:** Browser → Firebase (CORS errors)
**New way:** Browser → Your API → Firebase (no CORS)

## Security

- Admin password protects upload access
- Server validates all file uploads
- Firestore rules restrict writes to admin
- Storage rules restrict writes to authenticated users
- All validation happens server-side

## Performance

- Max file size: 500 KB (fast uploads)
- Images cached by CDN
- Firestore optimized for read-heavy workload
- No server processing needed, just storage & metadata

---

**Having issues?** Check `TROUBLESHOOTING.md` for detailed help!
